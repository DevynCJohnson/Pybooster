@function gtkalpha($c, $a) {
  @return unquote("alpha(#{$c},#{$a})");
}

$asset_suffix: if($variant == "dark", "-dark", "");


* {
  padding: 0px;
  -GtkDialog-action-area-border: 0;
  -GtkDialog-button-spacing: 4;
  -GtkHTML-link-color: $link_color;
  -GtkIMHtml-hyperlink-color: $link_color;
  -GtkScrolledWindow-scrollbar-spacing: 0;
  -GtkTextView-error-underline-color: $error_color;
  -GtkToolButton-icon-spacing: 4;
  -GtkToolItemGroup-expander-size: 12;
  -GtkTreeView-expander-size: 12;
  -GtkTreeView-horizontal-separator: 4;
  -GtkWidget-text-handle-height: 24;
  -GtkWidget-text-handle-width: 20;
  -WnckTasklist-fade-overlay-rect: 0;
  outline-color: gtkalpha(currentColor, 0.3);
  outline-style: dashed;
  outline-offset: -2px;
  outline-width: 1px;
  -gtk-outline-radius: 0px;
  -gtk-secondary-caret-color: $secondary_caret_color;
}


// Extend Blocks //


%button {
  @at-root %button_basic, & {
    border-radius: $button-radius;
    border: 1px solid;
    margin: 4px;
    min-height: 16px;
    min-width: 16px;
    outline-style: none;
    padding: 4px;

    @include button(normal);

    &.flat {
      @include button(undecorated);
      transition: 0s;
    }

    &.default {
      @include button(focus);
    }

    &:hover {
      @include button(hover);
      -gtk-icon-effect: highlight;
    }

    &:focus {
      @include button(focus);
    }

    &:active:hover, &:checked:hover {
      @include button(hoveractive);
    }

    &:active, &:checked {
      @include button(active);
    }

    &.flat {
      &:disabled {
        @include button(undecorated);
      }
    }

    &:disabled {
      text-shadow: if($variant == "light", inherit, 1px 1px 1px #666);
      @include button(insensitive);
      &:active, &:checked {
        @include button(insensitive-active);
      }
    }

    &.image-button {
      min-width: 24px;
      padding-left: 4px;
      padding-right: 4px;
    }

    &.text-button {
      padding-left: 16px;
      padding-right: 16px;
    }

    &.text-button.image-button {
      padding-left: 8px;
      padding-right: 8px;
      label {
        padding-left: 8px;
        padding-right: 8px;
      }
    }

    &:drop(active) {
      border-color: $drop_target_color;
      box-shadow: inset 0px 0px 0px 1px $drop_target_color;
      color: $drop_target_color;
    }
  }

  @at-root %button_selected, & {
    row:selected & {
      @if $variant == "light" {
        border-color: $focus_color;
      }

      &.flat:not(:active):not(:checked):not(:hover):not(disabled) {
        color: $selected_fg_color;
        border-color: transparent;
      }
    }
  }

  &.osd {
    min-height: 32px;
    min-width: 24px;

    &.image-button {
      min-width: 32px;
    }

    border-radius: $button-radius;
    color: $osd_fg_color;

    @include button(osd);

    border: none;
    box-shadow: none;

    &:hover {
      @include button(osd-hover);
      border: none;
      box-shadow: none;
    }

    &:active, &:checked {
      @include button(osd-active);
      border: none;
      box-shadow: none;
    }

    &:disabled {
      @include button(osd-insensitive);
      border: none;
    }
  }

  @at-root %osd_button, .osd & {
    @include button(osd);

    &:hover {
      @include button(osd-hover);
    }

    &:active, &:checked {
      @include button(osd-active);
    }

    &:disabled {
      @include button(osd-insensitive);
    }

    &.flat {
      @include button(undecorated);
      -gtk-icon-shadow: 0px 1px black;
      box-shadow: none;
      text-shadow: 0px 1px black;

      &:hover {
        @include button(osd-hover);
      }

      &:disabled {
        @include button(osd-insensitive);
        background-image: none;
        border-color: transparent;
        box-shadow: none;
      }

      &:active, &:checked {
        @include button(osd-active);
      }
    }
  }

  @each $b_type, $b_color in (suggested-action, $selected_bg_color), (destructive-action, $destructive_color) {
    &.#{$b_type} {
      @include button(normal, $b_color, white);

      &.flat {
        @include button(undecorated);
        color: $b_color;
      }

      &:hover {
        @include button(hover, $b_color, white);
      }

      &:active, &:checked {
        @include button(active, $b_color, white);
      }

      &.flat {
        &:disabled {
          @include button(undecorated);
          color: transparentize($b_color, 0.2);
        }
      }

      &:disabled {
        @include button(insensitive);
        &:focus, &.default {
          &, &:backdrop {
            @include button(undecorated);
          }
        }

        &:active,
        &:checked {
          @include button(insensitive-active, $b_color, white);
        }
      }

      .osd & {
        @include button(osd, $b_color);
        &:hover {
          @include button(osd-hover, $b_color);
        }

        &:active,
        &:checked {
          @include button(osd-active, $b_color);
        }

        &:disabled {
          @include button(osd-insensitive, $b_color);
        }
      }
    }
  }

  .stack-switcher > & {
    > label {
      padding-left: 8px;
      padding-right: 8px;
    }

    > image {
      padding-bottom: 4px;
      padding-left: 8px;
      padding-right: 8px;
      padding-top: 4px;
    }

    &.text-button {
      padding-left: 8px;
      padding-right: 8px;
    }

    &.image-button {
      padding-left: 2px;
      padding-right: 2px;
    }

    &.needs-attention {
      > label,
      > image {
        @extend %needs_attention;
      }

      &:active,
      &:checked {
        > label,
        > image {
          animation: none;
          background-image: none;
        }
      }
    }
  }

  &.font,
  &.file {
    separator {
      background-color: transparent;
    }
  }

  &.font {
    > box > box > label {
      font-weight: bold;
    }
  }

  .inline-toolbar &, .inline-toolbar &:backdrop {
    border-radius: $button-radius;
    border-width: 1px;

    @extend %linked;
  }

  .primary-toolbar & {
    -gtk-icon-shadow: none;
  }

  @extend %linked_btn;

  &.circular {
    -gtk-outline-radius: 8192px;
    border-radius: 8192px;
    padding: 4px;
    label {
      padding: 0px;
    }
  }
}

%column_header_button {
  background-image: $shiny;
  border-color: $fg_color;
  border-radius: $button-radius;
  border-style: solid;
  border-width: 1px;
  padding: 0px 8px;
  text-shadow: none;

  &:disabled {
    background-image: none;
    border-color: $fg_color;
    color: $insensitive_fg_color;
  }

  &:last-child {
    &:backdrop, & {
      border-right-style: none;
    }
  }
}

%darkbar {
  background-color: darken($bg_color, 10%);
}

%header_widgets {
  color: if($dark_header == "true", $dark_fg_color, $fg_color);

  @if $variant == "light" and $dark_header == "true" {
    button, .text-button, .image-button {
      border-radius: $button-radius;
      border-width: 0px;
      color: $dark_fg_color;

      @include button(headerbutton-normal);

      &:hover {
        @include button(headerbutton-hover);
      }

      &:focus, &.default, &:focus:hover, &.default:hover {
        @include button(headerbutton-focus);
      }

      &:checked, &:active {
        @include button(headerbutton-active);
      }

      &:checked:hover, &:active:hover {
        @include button(headerbutton-hoveractive);
      }

      &:disabled {
        @include button(headerbutton-disabled);
      }

      &:backdrop {
        color: $backdrop_fg_color;
      }

      &:backdrop:hover {
        color: $selected_fg_color;
      }
    }

    entry {
      @include entry(normal-header);

      &:focus {
        @include entry(focus);
      }

      &:disabled {
        @include entry(insensitive-header);
      }

      caret-color: $dark_fg_color;
    }

    button.suggested-action {
      color: $selected_fg_color;

      &:disabled {
        @include button(undecorated-disabled);
      }

      &:backdrop:not(:disabled) {
        color: $selected_fg_color;
      }
    }

    .linked:not(entry) {
      button:not(:last-child):not(:only-child) {
        border-right-style: solid;
      }

      button:not(:only-child) {
        border-radius: $button-radius;
      }
    }

    switch {
      background-color: $close_button;
      box-shadow: none;
    }
  }
}

%link {
  color: $link_color;

  &:visited {
    color: $link_visited_color;
    *:selected & {
      color: mix($selected_fg_color, $selected_bg_color, 60%);
    }
  }

  &:hover {
    color: lighten($link_color, 10%);
    *:selected & {
      color: mix($selected_fg_color, $selected_bg_color, 90%);
    }
  }

  &:active {
    color: $link_color;
    *:selected & {
      color: mix($selected_fg_color, $selected_bg_color, 80%);
    }
  }

  &:disabled, &:disabled:backdrop {
    color: transparentize(desaturate($link_color, 100%), 0.2);
  }

  &:backdrop {
    &:backdrop:hover, &:backdrop:hover:selected, & {
      color: $selected_bg_color;
    }
  }

  @at-root %link_selected,
  &:selected,
  *:selected & {
    color: mix($selected_fg_color, $selected_bg_color, 80%);
  }
}

%linked {
  @extend %linked_middle;
  @extend %linked_first_child;
  @extend %linked_last_child;
  @extend %linked_only_child;
}

%linked_first_child {
  &:first-child {
    @extend %linked_left;
  }
}

%linked_last_child {
  &:last-child {
    @extend %linked_right;
  }
}

%linked_only_child {
  &:only-child {
    border-radius: $button-radius;
    border-style: solid;
  }
}

%linked_btn {
  .linked > &,
  .linked > &:hover,
  .linked > &:active,
  .linked > &:checked,
  .linked > &:backdrop {
    @extend %linked;
  }
  .linked.vertical > &,
  .linked.vertical > &:hover,
  .linked.vertical > &:active,
  .linked.vertical > &:checked,
  .linked.vertical > &:backdrop {
    @extend %linked_vertical;
  }
}

%linked_flippable {
  @extend %linked_middle;

  &:dir(ltr) {
    &:first-child {
      @extend %linked_left;
    }

    &:last-child {
      @extend %linked_right;
    }
  }

  &:dir(rtl) {
    &:first-child {
      @extend %linked_right;
    }

    &:last-child {
      @extend %linked_left;
    }
  }

  &:only-child {
    border-radius: $button-radius;
    border-style: solid;
  }
}

%linked_left {
  &:active, &:checked {
    @include button(active);
  }

  &:active:hover, &:checked:hover {
    @include button(hoveractive);
  }

  border-bottom-left-radius: $button-radius;
  border-bottom-right-radius: 0px;
  border-left-style: solid;
  border-right-style: solid;
  border-top-left-radius: $button-radius;
  border-top-right-radius: 0px;
  box-shadow: $btn-shadow-left;

  &:hover:not(:checked):not(:active) {
    box-shadow: $btn-shadow-left-hover;
  }
}

%linked_middle {
  &:active, &:checked {
    @include button(active);
  }

  &:active:hover, &:checked:hover {
    @include button(hoveractive);
  }

  border-left-style: solid;
  border-radius: $button-radius;
  border-right-style: solid;
  box-shadow: $btn-shadow-middle;

  &:hover:not(:checked):not(:active) {
    box-shadow: $btn-shadow-middle-hover;
  }
}

%linked_right {
  &:active, &:checked {
    @include button(active);
  }

  &:active:hover, &:checked:hover {
    @include button(hoveractive);
  }

  border-bottom-left-radius: 0px;
  border-bottom-right-radius: $button-radius;
  border-left-style: solid;
  border-right-style: solid;
  border-top-left-radius: 0px;
  border-top-right-radius: $button-radius;
  box-shadow: $btn-shadow-right;

  &:hover:not(:checked):not(:active) {
    box-shadow: $btn-shadow-right-hover;
  }
}

%linked_vertical {
  border-radius: $button-radius;
  border-style: solid;
  @extend %linked_vertical_first_child;
  @extend %linked_vertical_last_child;
  @extend %linked_vertical_only_child;
}

%linked_vertical_first_child {
  &:first-child {
    border-radius: $button-radius;
  }
}

%linked_vertical_last_child {
  &:last-child {
    border-bottom-left-radius: $button-radius;
    border-bottom-right-radius: $button-radius;
    border-style: solid;
  }
}

%linked_vertical_only_child {
  &:only-child {
    border-radius: $button-radius;
    border-style: solid;
  }
}

%menu_appearance {
  background-color: $base_color;
  border: none;
  box-shadow: none;
  padding: 0px;
  .csd & {
    border: none;
    box-shadow: none;
    padding: 0px;
  }
  arrow {
    @extend %menu_arrow;
  }
  > menuitem {
    background-color: $base_color;
    border: none;
    box-shadow: none;
    padding: 2px 8px;
  }
}

%menu_arrow {
  @extend %undecorated_button;
  background-color: $menu_bg_color;
  border: none;
  color: $text_color;
  min-height: 16px;
  min-width: 16px;
  padding: 4px;

  &:dir(ltr) {
    -gtk-icon-source: -gtk-icontheme("pan-end-symbolic");
    margin-left: 4px;
  }

  &:dir(rtl) {
    -gtk-icon-source: -gtk-icontheme("pan-end-symbolic-rtl");
    margin-right: 4px;
  }

  &.top {
    -gtk-icon-source: -gtk-icontheme("pan-up-symbolic");
    border-bottom: 1px solid mix($fg_color, $base_color, 10%);
    margin-top: -4px;
  }

  &.bottom {
    -gtk-icon-source: -gtk-icontheme("pan-down-symbolic");
    border-top: 1px solid mix($fg_color, $base_color, 10%);
    margin-bottom: -8px;
    margin-top: 8px;
  }

  &:hover {
    background-color: mix($fg_color, $base_color, 10%);
  }

  &:disabled {
    background-color: $menu_bg_color;
    border: none;
    color: $secondary_bg_color;
  }
}

%menuitem {
  background-color: $menu_bg_color;
  border: none;
  box-shadow: none;
  color: if($dark_header == "true" or $variant == "dark", $dark_fg_color, $fg_color);
  min-height: 16px;
  min-width: 16px;
  padding: 0px;
  text-shadow: none;

  menu {
    .csd &, & {
      border: none;
      box-shadow: none;
    }
  }

  &:active, &:focus, &:hover {
    background-color: $selected_bg_color;
    color: $selected_text_color;
  }

  &:backdrop {
    color: $backdrop_fg_color;
  }

  &:disabled {
    box-shadow: none;
    color: $insensitive_fg_color;
  }

  accelerator {
    color: gtkalpha(currentColor, 0.5);
  }

  label {
    &:dir(rtl), &:dir(ltr) {
      color: inherit;
    }
  }
}

%needs_attention {
  animation: needs_attention 150ms ease-in;
  background-image: radial-gradient(farthest-side, $_dot_color 96%, transparentize($_dot_color, 1)), radial-gradient(farthest-side, $_dot_shadow 95%, transparentize($_dot_shadow, 1));
  background-position: right 4px, right 4px;
  background-repeat: no-repeat;
  background-size: 8px 8px;

  &:backdrop {
    background-size: 8px 8px, 0px 0px;
  }

  &:dir(rtl) {
    background-position: left 4px, left 4px;
  }
}

%osd {
  -gtk-icon-shadow: 0px 1px #000;
  background-clip: padding-box;
  background-color: $osd_bg_color;
  border: none;
  color: $osd_fg_color;
  text-shadow: 0px 1px black;
}

%panelbutton {
  background-color: transparent;
  border-radius: $button-radius;
  border: none;
  box-shadow: none;
  color: $dark_fg_color;
  min-height: $icon_size;
  min-width: $icon_size;
  transition-duration: 0s;

  &:hover {
    background-color: $dark_fg_color;
    color: $dark_bg_color;
  }

  &:active, &:checked {
    color: $selected_fg_color;
    background-color: $selected_bg_color;

    &:hover {
      background-color: darken($selected_bg_color, 4%);
    }
  }
}

%scale_highlight {
  background-color: $scale_color;
  border-radius: $scale_radius;
  border: 1px solid $selected_bg_color;

  &:disabled {
    background-color: transparent;
    border-color: transparent;
  }

  row:selected &, menuitem:hover & {
    &:disabled, & {
      border-color: $focus_color;
    }
  }

  .osd & {
    border-color: $osd_borders_color;
    &:disabled {
      border-color: transparent;
    }
  }
}

%scale_trough {
  background-color: $dark_fill;
  border-radius: $scale_radius;
  border: 1px inset darken($dark_fill, 20%);
  box-shadow: none;

  &:disabled {
    background-color: $insensitive_bg_color;
    box-shadow: none;
  }

  row:selected & {
    box-shadow: none;

    &, &:disabled {
      border-color: $focus_color;
    }
  }

  .osd & {
    background-color: transparentize($osd_borders_color, 0.2);
    border-color: $osd_borders_color;
    box-shadow: none;

    &:disabled {
      background-color: $osd_insensitive_bg_color;
    }
  }
}

%selected_items {
  background-color: $selected_bg_color;

  @at-root %nobg_selected_items, & {
    color: $selected_fg_color;

    &:disabled {
      color: mix($selected_fg_color, $selected_bg_color, 50%);
    }

    &:backdrop {
      color: $backdrop_selected_fg_color;

      &, &:hover {
        background-color: $selected_bg_color;
      }

      &:disabled {
        color: mix($backdrop_selected_fg_color, $selected_bg_color, 30%);
      }
    }
  }
}

%titlebar {
  background-color: $header_bg;
  border-color: $borders_color;
  border-style: solid;
  border-width: 0px 0px 1px;
  box-shadow: inset 0 1px transparentize($borders_edge, 0.4), inset 0 -1px transparentize($borders_edge, 0.7);
  min-height: 32px;
  padding: 0px 4px;

  &:backdrop {
    border-color: $borders_color;
    color: $backdrop_fg_color;
  }

  .title {
    font-weight: bold;
    padding-left: 16px;
    padding-right: 16px;
  }

  .subtitle {
    font-size: smaller;
    padding-left: 16px;
    padding-right: 16px;

    @extend .dim-label;
  }

  .selection-mode &,
  &.selection-mode {
    $_hc: mix($borders_edge, $selected_bg_color, 50%);
    background-color: $selected_bg_color;
    border-color: $focus_color;
    box-shadow: inset 0 1px $_hc, inset 0 -1px transparentize($borders_edge, 0.7);
    color: $selected_fg_color;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);

    &:backdrop {
      background-color: $selected_bg_color;
      background-image: none;
      box-shadow: inset 0px 1px mix($borders_edge, $selected_bg_color, 60%);

      label {
        color: $selected_fg_color;
        text-shadow: none;
      }
    }

    button {
      @include button(normal, $selected_bg_color, $selected_fg_color);

      &.flat {
        @include button(undecorated);
      }

      &:hover {
        @include button(hover, $selected_bg_color, $selected_fg_color);
      }

      &:active,
      &:checked,
      &.toggle:checked,
      &.toggle:active {
        @include button(active, $selected_bg_color, $selected_fg_color);
      }

      &.flat {
        &:backdrop, &:disabled, &:backdrop:disabled {
          @include button(undecorated);
        }
      }

      &:disabled {
        @include button(insensitive, $selected_bg_color, $selected_fg_color);

        &:active,
        &:checked {
          @include button(insensitive-active, $selected_bg_color, $selected_fg_color);
        }
      }

      &.suggested-action {
        @include button(normal);
        border-color: $focus_color;

        &:hover {
          @include button(hover);
          border-color: $focus_color;
        }

        &:active {
          @include button(active);
          border-color: $focus_color;
        }

        &:disabled {
          @include button(insensitive);
          border-color: $focus_color;
        }

        &:backdrop:disabled {
          @include button(backdrop-insensitive);
          border-color: $focus_color;
        }
      }
    }

    .selection-menu {
      &:backdrop, & {
        background-color: transparentize($selected_bg_color, 1);
        background-image: none;
        border-color: transparentize($selected_bg_color, 1);
        box-shadow: none;
        padding-left: 8px;
        padding-right: 8px;

        arrow {
          -GtkArrow-arrow-scaling: 1;
        }

        .arrow {
          -gtk-icon-shadow: none;
          -gtk-icon-source: -gtk-icontheme("pan-down-symbolic");
          color: transparentize($selected_fg_color, 0.5);
        }
      }
    }
  }

  .tiled &,
  .tiled-top &,
  .tiled-right &,
  .tiled-bottom &,
  .tiled-left &,
  .maximized &,
  .fullscreen & {
    &:backdrop, & {
      border-radius: 0px;
    }
  }

  .maximized & {
    box-shadow: inset 0px -1px transparentize($borders_edge, 0.7);
  }

  &.default-decoration {
    min-height: 28px;
    padding: 4px;

    .maximized & {
      box-shadow: none;
    }

    button.titlebutton {
      margin: 0px;
      min-height: $titlebutton-height;
      min-width: $titlebutton-width;
      padding: $titlebutton-padding;
    }
  }

  separator {
    background-color: transparent;
    &:backdrop {
      background-color: $header_bg;
      box-shadow: inset 0 1px transparentize($borders_edge, 0.4), inset 0 -1px transparentize($borders_edge, 0.7);
    }
  }

  separator.titlebutton {
    opacity: 0;
  }

  .solid-csd & {
    &:backdrop, & {
      &:dir(rtl), &:dir(ltr) {
        border-radius: 0px;
        box-shadow: none;
        margin-left: -1px;
        margin-right: -1px;
        margin-top: -1px;
      }
    }
  }
}

%titlebutton {
  border-radius: 2px;
  margin: 2px;
  min-height: $titlebutton-height;
  min-width: $titlebutton-width;
  padding: 0px;
}

%toolbar {
  -GtkWidget-window-dragging: true;
  background-color: $toolbar_color;
  box-shadow: inset 0px 2px transparentize($borders_color, 0.65);
  padding: 4px;
}

%undecorated_button {
  -gtk-icon-shadow: none;
  background-color: transparent;
  background-image: none;
  border-color: transparent;
  box-shadow: inset 0 1px transparentize(white, 1), 0 1px transparentize(white, 1);
  text-shadow: none;
}

// Base States //


*:disabled {
  -gtk-icon-effect: dim;
}

.background {
  background-color: $bg_color;
  color: $fg_color;

  &:backdrop {
    color: $backdrop_fg_color;
  }
}

.gtkstyle-fallback {
  background-color: $bg_color;
  color: $fg_color;

  &:active {
    background-color: darken($bg_color, 10%);
    color: $fg_color;
  }

  &:disabled {
    background-color: $insensitive_bg_color;
    color: $insensitive_fg_color;
  }

  &:hover {
    background-color: lighten($bg_color, 10%);
    color: $fg_color;
  }

  &:selected {
    background-color: $selected_bg_color;
    color: $selected_fg_color;
  }
}

.entry-tag {
  background-color: $_entry_tag_bg;
  border-style: none;
  color: $_entry_tag_color;
  margin-bottom: 2px;
  margin-top: 2px;
  padding: 4px;

  :dir(ltr) & {
    margin-left: 8px;
    margin-right: -4px;
  }

  :dir(rtl) & {
    margin-left: -4px;
    margin-right: 8px;
  }

  &:hover {
    background-color: lighten($_entry_tag_bg, 10%);
  }

  :backdrop & {
    background-color: if($variant == "light", $selected_bg_color, mix($backdrop_fg_color, $base_color, 50%));
    color: $base_color;
  }

  &.button {
    background-color: transparent;
    color: transparentize($_entry_tag_color, 0.3);
  }

  :not(:backdrop) &.button {
    &:hover {
      border: 1px solid $_entry_tag_bg;
      color: $_entry_tag_color;
    }

    &:active {
      background-color: $_entry_tag_bg;
      color: transparentize($_entry_tag_color, 0.3);
    }
  }
}

.view, iconview, textview {
  background-color: $secondary_bg_color;
  caret-color: $caret_color;
  color: $text_color;

  &:backdrop {
    color: $backdrop_text_color;
    background-color: $secondary_bg_color;
    &:disabled {
      color: $backdrop_insensitive_color;
    }
  }

  &:backdrop:hover, &:hover {
    background-color: $selected_bg_color;
  }

  &:disabled {
    color: $insensitive_fg_color;
    background-color: $insensitive_bg_color;
  }

  &:selected {
    border-radius: 0px;
    @extend %selected_items;
  }

  text {
    background-color: $secondary_bg_color;
    color: $text_color;
    selection {
      background-color: $selected_bg_color;
      color: $selected_text_color;
      &:focus, & {
        @extend %selected_items;
      }
    }
  }
}

textview border {
  background-color: $secondary_borders_color;
}

.rubberband, rubberband {
  background-color: transparentize(darken($selected_bg_color, 10%), 0.8);
  border: 1px solid darken($selected_bg_color, 10%);
}

flowbox {
  rubberband {
    @extend rubberband;
  }

  flowboxchild {
    padding: 4px;

    &:selected {
      @extend %selected_items;
    }
  }
}

.content-view .tile {
  background-color: $secondary_bg_color;
  border-radius: 0px;
  margin: 2px;
  padding: 0px;

  &:active, &:selected {
    background-color: $selected_bg_color;
  }

  &:backdrop {
    background-color: darken($base_color, 5%);
  }

  &:disabled {
    background-color: $insensitive_bg_color;
  }
}

label {
  caret-color: currentColor;

  &.separator {
    @extend .dim-label;
    color: $fg_color;
  }

  row:selected &,
  &:selected {
    @extend %nobg_selected_items;
  }

  selection {
    background-color: $selected_bg_color;
    color: $selected_fg_color;
  }

  &:disabled {
    color: $insensitive_fg_color;
    selection {
      &:disabled {
        color: mix($selected_fg_color, $selected_bg_color, 50%);
      }
    }
    &:backdrop {
      color: $backdrop_insensitive_color;
    }
  }
}

assistant {
  .sidebar {
    background-color: $base_color;
    border-top: 1px solid $borders_color;
  }

  &.csd .sidebar {
    border-top-style: none;
  }

  .sidebar label {
    padding: 4px 8px;
  }

  .sidebar label.highlight {
    background-color: mix($bg_color, $fg_color, 80%);
  }
}

.osd {
  @extend %osd;
}

statusbar, .statusbar {
  font-size: smaller;

  & button {
    min-height: 16px;
    padding: 0px;
  }
}

// Calendar //

calendar {
  border: 1px solid $borders_color;
  color: $text_color;

  &:selected {
    @extend %selected_items;
    border-radius: $button-radius;
  }

  &.header {
    border-bottom-color: rgba(0, 0, 0, 0.2);
  }

  &.button {
    @extend %undecorated_button;
    color: transparentize($fg_color, 0.5);

    &:hover {
      background-color: darken($bg_color, 30%);
      color: $text_color;
    }

    &:disabled {
      color: transparentize($insensitive_fg_color, 0.5);
    }
  }

  &.highlight {
    color: $insensitive_fg_color;
  }

  &:indeterminate {
    color: gtkalpha(currentColor, 0.1);
  }
}

calendar-view  {
  -gtk-outline-radius: 0px;
  outline-color: $selected_bg_color;
  outline-offset: -4px;
  outline-style: solid;
  outline-width: 2px;
}


// Expanders //

expander {
  title > arrow {
    -gtk-icon-source: -gtk-icontheme("pan-end-symbolic");
    min-height: 16px;
    min-width: 16px;

    &:dir(rtl) {
      -gtk-icon-source: -gtk-icontheme("pan-end-symbolic-rtl");
    }

    &:hover {
      color: lighten($fg_color, 30%);
    }

    &:disabled {
      color: $insensitive_fg_color;
    }

    &:disabled:backdrop {
      color: $backdrop_insensitive_color;
    }

    &:checked {
      -gtk-icon-source: -gtk-icontheme("pan-down-symbolic");
    }
  }
}

// Tooltips //

tooltip {
  &.background {
    background-clip: padding-box;
    background-color: rgba(0, 0, 0, 0.8);
    border: 1px solid $tooltip_borders_color;
  }

  border-radius: 0px;
  box-shadow: none;
  padding: 0px;
  text-shadow: 0 1px black;

  decoration {
    background-color: transparent;
  }

  * {
    background-color: transparent;
    color: white;
    padding: 2px;
  }
}

// Spinners //

spinner {
  background: none;
  opacity: 0;
  -gtk-icon-source: -gtk-icontheme("process-working-symbolic");
  &:checked {
    opacity: 1;
    animation: spin 1s linear infinite;
    &:disabled {
      opacity: 0.5;
    }
  }
}

spinbutton {
  &:not(.vertical) {
    @extend %entry;
    padding: 0px;

    entry {
      background-color: transparent;
      background: none;
      border-radius: $button-radius;
      border: none;
      box-shadow: none;
      margin: 0px;
      min-width: 32px;
      padding: 0px;
    }

    button {
      background-image: none;
      border-color: transparentize($borders_color, 0.7);
      border-radius: $button-radius;
      border-style: none none none solid;
      box-shadow: none;
      color: mix($fg_color, $base_color, 90%);
      margin: 0px;
      min-height: 16px;
      min-width: 16px;
      padding-bottom: 0px;
      padding-top: 0px;

      &:dir(rtl) {
        border-style: none solid none none;
      }

      &:hover {
        background-color: lighten($bg_color, 18%);
        color: $fg_color;
      }

      &:disabled {
        color: transparentize($insensitive_fg_color, 0.7);
      }

      &:active {
        background-color: if($variant == "dark", lighten($bg_color, 30%), darken($bg_color, 12%));
        color: $fg_color;
      }
    }
  }

  .osd &:not(.vertical) {
    padding: 0px;
    button {
      @include button(undecorated);
      -gtk-icon-shadow: 0px 1px black;
      border-color: transparentize($osd_borders_color, 0.3);
      border-radius: $button-radius;
      border-style: none none none solid;
      box-shadow: none;
      color: $osd_fg_color;

      &:dir(rtl) {
        border-style: none solid none none;
      }

      &:hover {
        @include button(undecorated);
        -gtk-icon-shadow: 0 1px black;
        background-color: transparentize($osd_fg_color, 0.9);
        border-color: transparentize(opacify($osd_borders_color, 1), 0.5);
        box-shadow: none;
        color: $osd_fg_color;
      }

      &:disabled {
        @include button(undecorated);
        -gtk-icon-shadow: none;
        border-color: transparentize(opacify($osd_borders_color, 1), 0.5);
        box-shadow: none;
        color: $osd_insensitive_fg_color;
      }

      &:last-child {
        border-radius: 0 $button-radius $button-radius 0;
      }

      &:dir(rtl):first-child {
        border-radius: 0 $button-radius $button-radius 0;
      }
    }
  }

  &.vertical {
    padding-bottom: 0px;
    padding-left: 0px;
    padding-right: 0px;
    padding-top: 0px;
    &:disabled {
      color: $insensitive_fg_color;
    }

    &:drop(active) {
      border-color: transparent;
      box-shadow: none;
    }

    entry {
      border-radius: $entry-radius;
      min-height: 32px;
      min-width: 32px;
      padding-left: 0px;
      padding-right: 0px;
      padding-top: 0px;
      padding-bottom: 0px;
    }

    button {
      min-height: 32px;
      min-width: 32px;
      padding: 0px;

      &.up {
        @extend %top_button;
      }

      &.down {
        @extend %bottom_button;
      }
    }

    %top_button {
      border-radius: $button-radius $button-radius 0 0;
      border-style: solid solid none solid;
    }

    %bottom_button {
      border-radius: 0 0 $button-radius $button-radius;
      border-style: none solid solid solid;
    }
  }

  .osd &.vertical button:first-child {
    @include button(osd);

    &:hover {
      @include button(osd-hover);
    }

    &:active {
      @include button(osd-active);
    }

    &:disabled {
      @include button(osd-insensitive);
    }
  }

  treeview &:not(.vertical) {
    border-radius: 0px;
    border-style: none;
    min-height: 0px;

    entry {
      min-height: 0px;
      padding: 1px 2px;
    }
  }
}

// Links //

:link, .selection-mode .subtitle:link {
  @extend %link;
}

// Text Entries //

%entry, entry {
  & {
    border-radius: $entry-radius;
    border: 1px solid #919191;
    caret-color: $caret_color;
    min-height: 24px;
    padding: 0px;
    transition: 0s;

    @include entry(normal);

    image {
      &.right {
        margin: 0px;
        padding: 4px;
      }
    }

    &.flat {
      &:focus, &:backdrop, &:disabled, &:backdrop:disabled, & {
        background-image: none;
        border-color: transparent;
        border-radius: $entry-radius;
        min-height: 0px;
        padding: 0px 2px;
      }
    }

    &:focus {
      @include entry(focus);
    }

    &:disabled {
      @include entry(insensitive);
    }

    selection {
      @extend %selected_items;
    }

    @each $e_type, $e_color in (error, $error_color), (warning, $warning_color) {
      &.#{$e_type} {
        border-color: $focus_color;
        color: $e_color;

        &:focus {
          @include entry(focus, $e_color);
        }

        selection {
          background-color: $e_color;
        }
      }
    }

    & image {
      &:focus {
        background-color: $entry_image_focus_color;
      }

      &:active, &:active:focus {
        background-color: $active_color;
      }

      &:hover, &:hover:focus {
        background-color: $select_color;
      }
    }

    &:drop(active) {
      &:focus, & {
        border-color: $drop_target_color;
        box-shadow: inset 0px 0px 0px 1px $drop_target_color;
      }
    }

    .osd & {
      @include entry(osd);

      &:focus {
        @include entry(osd-focus);
      }

      &:disabled {
        @include entry(osd-insensitive);
      }
    }
  }

  progress {
    background-color: transparent;
    background-image: none;
    border-color: $selected_bg_color;
    border-radius: 0px;
    border-style: solid;
    border-width: 0px 0px 2px;
    box-shadow: none;
    margin: 2px -8px;

    &:backdrop {
      background-color: transparent;
    }
  }

  .linked:not(.vertical) > & {
    @extend %linked;
  }

  .linked:not(.vertical) > &:focus + &,
  .linked:not(.vertical) > &:focus + button,
  .linked:not(.vertical) > &:focus + combobox > box > button.combo {
    border-left-color: $focus_color;
  }

  .linked:not(.vertical) > &:focus.error + &,
  .linked:not(.vertical) > &:focus.error + button,
  .linked:not(.vertical) > &:focus.error + combobox > box > button.combo {
    border-left-color: $error_color;
  }

  .linked:not(.vertical) > &:drop(active) + &,
  .linked:not(.vertical) > &:drop(active) + button,
  .linked:not(.vertical) > &:drop(active) + combobox > box > button.combo {
    border-left-color: $drop_target_color;
  }

  .linked.vertical > & {
    @extend %linked_vertical;

    &:not(:disabled) + entry:not(:disabled),
    &:not(:disabled) + %entry:not(:disabled) {
      border-top-color: mix($borders_color, $base_color, 30%);
    }

    &:disabled + %entry:disabled,
    &:disabled + entry:disabled {
      border-top-color: mix($borders_color, $base_color, 30%);
    }

    + %entry:focus:not(:only-child),
    + entry:focus:not(:only-child) {
      border-top-color: $focus_color;
    }

    + %entry:focus.error:not(:only-child),
    + entry:focus.error:not(:only-child) {
      border-top-color: $error_color;
    }

    + %entry:drop(active):not(:only-child),
    + entry:drop(active):not(:only-child) {
      border-top-color: $drop_target_color;
    }

    &:focus:not(:only-child) {
      + %entry,
      + entry,
      + button,
      + combobox > box > button.combo {
        border-top-color: $focus_color;
      }
    }

    &:focus.error:not(:only-child) {
      + %entry,
      + entry,
      + button,
      + combobox > box > button.combo {
        border-top-color: $error_color;
      }
    }

    &:drop(active):not(:only-child) {
      + %entry,
      + entry,
      + button,
      + combobox > box > button.combo {
        border-top-color: $drop_target_color;
      }
    }
  }
}

.emoji-picker > entry > image, entry.search > image, entry.search > image:active, entry.search > image:active:focus, entry.search > image:focus, entry.search > image:hover, entry.search > image:hover:focus, entry > image.left, entry > image.left:active, entry > image.left:active:focus, entry > image.left:focus, entry > image.left:hover, entry > image.left:hover:focus {
  background-color: inherit;
}

treeview acceleditor > label {
  background-color: $selected_bg_color;
}

treeview entry {
  &:focus {
    &:dir(rtl), &:dir(ltr) {
      background-color: $base_color;
    }
  }

  &.flat, & {
    border-radius: $entry-radius;
    background-image: none;
    background-color: $base_color;

    &:focus {
      border-color: $selected_bg_color;
    }
  }
}

// Buttons //

button {
  @extend %button;
}

.path-bar button.image-button, .path-bar button.text-button, .stack-switcher button.image-button, .stack-switcher button.text-button, button.image-button, button.text-button {
  &:hover:not(:checked) {
    @include button(hover);
    -gtk-icon-effect: highlight;
  }

  &:focus {
    @include button(focus);
  }

  &:active:hover:not(:checked) {
    @include button(hoveractive);
  }

  check {
    &:hover:not(:checked) {
      @include button(hover);
      -gtk-icon-effect: highlight;
    }
    &:focus {
      @include button(focus);
    }
    &:active:hover:not(:checked) {
      @include button(hoveractive);
    }
  }
}

toolbutton:disabled > button {
  text-shadow: 1px 1px 1px #666;
}

.inline-toolbar toolbutton > button {
  @include button(normal);

  &:hover {
    @include button(hover);
  }

  &:active, &:checked {
    @include button(active);
  }

  &:disabled {
    @include button(insensitive);

    &:active, &:checked {
      @include button(insensitive-active);
    }
  }
}

toolbar.inline-toolbar toolbutton {
  > button.flat {
    @extend %linked_middle;
  }

  &:first-child > button.flat {
    @extend %linked_first_child;
  }

  &:last-child > button.flat {
    @extend %linked_last_child;
  }

  &:only-child > button.flat {
    @extend %linked_only_child;
  }
}

button:link, button:visited {
  @extend %undecorated_button;
  @extend :link;
  text-shadow: none;

  &:active, &:checked, &:hover {
    @extend %undecorated_button;
    text-shadow: none;
  }

  > label {
    @extend %link;
    text-decoration-line: underline;
  }
}

// Menu Buttons //

modelbutton.flat, .menuitem.button.flat {
  border-radius: $button-radius;
  min-height: 26px;
  padding-left: 4px;
  padding-right: 4px;

  @extend %undecorated_button;

  &:hover {
    background-color: $popover_hover_color;
  }

  &:selected {
    @extend %selected_items;
  }

  check:last-child,
  radio:last-child {
    margin-left: 8px;
  }

  check:first-child,
  radio:first-child {
    margin-right: 8px;
  }
}

modelbutton.flat arrow {
  background: none;

  &:hover {
    background: none;
  }

  &.left {
    -gtk-icon-source: -gtk-icontheme("pan-start-symbolic");
  }

  &.right {
    -gtk-icon-source: -gtk-icontheme("pan-end-symbolic");
  }
}

button.color {
  padding: 4px;

  colorswatch:only-child {
    &, overlay {
      border-radius: $button-radius;
    }

    @if $variant == "light" {
      box-shadow: 0px 1px transparentize(white, 1 - (lightness($bg_color) / 100%) / (lightness($bg_color) / 100% * 1.3));
      .osd & {
        box-shadow: none;
      }
    }
  }

  @if $variant == "light" {
    .osd &, & {
      &:disabled,
      &:backdrop,
      &:active,
      &:checked {
        colorswatch:only-child {
          box-shadow: none;
        }
      }
    }
  }
}

// ComboBoxes //

combobox {
  arrow {
    -gtk-icon-source: -gtk-icontheme("pan-down-symbolic");
    min-height: 16px;
    min-width: 16px;
  }

  &.linked {
    button:nth-child(2) {
      &:dir(ltr) {
        @extend %linked_last_child;
      }

      &:dir(rtl) {
        @extend %linked_first_child;
      }
    }
  }

  &:drop(active) {
    box-shadow: none;
    button.combo {
      @extend %button_basic, :drop(active);
    }
  }

  &:focus {
      @include button(focus);
    }

}

.linked > combobox > box > button.combo {
  &:dir(ltr),
  &:dir(rtl) {
    @extend %linked_middle;
  }
}

.linked:not(.vertical) > combobox:first-child > box > button.combo {
  @extend %linked_only_child;
}

.linked:not(.vertical) > combobox:last-child > box > button.combo {
  @extend %linked_last_child;
}

.linked:not(.vertical) > combobox:only-child > box > button.combo {
  @extend %linked_only_child;
}

.linked.vertical > combobox > box > button.combo {
  border-radius: $button-radius;
  border-style: solid;
}

.linked.vertical > combobox:first-child > box > button.combo {
  @extend %linked_vertical_first_child;
}

.linked.vertical > combobox:last-child > box > button.combo {
  @extend %linked_vertical_last_child;
}

.linked.vertical > combobox:only-child > box > button.combo {
  @extend %linked_vertical_only_child;
}

// Toolbars //

toolbar {
  @extend %toolbar;

  .osd & {
    background-color: transparent;
  }

  &.osd {
    background-color: $osd_bg_color;
    border-radius: $button-radius;
    border: none;
    padding: 8px;

    &.left, &.right, &.top, &.bottom {
      border-radius: $button-radius;
    }
  }

  &.horizontal separator {
    margin: 0px 4px 2px 4px;
  }

  &.vertical separator {
    margin: 4px 2px 4px 0px;
  }

  &:not(.inline-toolbar):not(.osd) {
    > *:not(.toggle):not(.popup) > * {
      margin-bottom: 1px;
      margin-right: 1px;
    }
  }
}

.inline-toolbar {
  @extend %toolbar;
  @extend %darkbar;
  border-radius: 0px 0px $button-radius $button-radius;
  border-width: 0px 1px 1px;
}

searchbar > revealer > box,
.location-bar {
  @extend %toolbar;
  @extend %darkbar;
  border-width: 0px 0px 1px;
}

searchbar > revealer > box {
  margin: -8px;
  padding: 8px;
}

// Headerbars & Headerbar Widgets //

headerbar {
  @extend %titlebar;

  entry, spinbutton, separator:not(.sidebar), button {
    margin-bottom: 4px;
    margin-top: 4px;
  }

  switch {
    margin-bottom: 8px;
    margin-top: 8px;
  }

  &.titlebar headerbar:not(.titlebar) {
    background: none;
    box-shadow: none;
  }

  window separator:first-child + &,
  window &:first-child {
    &:backdrop, & {
      border-top-left-radius: $window-radius;
    }
  }

  window &:last-child {
    &:backdrop, & {
      border-top-right-radius: $window-radius;
    }
  }

  window stack & {
    &:first-child, &:last-child {
      &:backdrop, & {
        border-top-left-radius: $window-radius;
        border-top-right-radius: $window-radius;
      }
    }
  }

  window.tiled &,
  window.tiled-top &,
  window.tiled-right &,
  window.tiled-bottom &,
  window.tiled-left &,
  window.maximized &,
  window.fullscreen &,
  window.solid-csd & {
    &, &:backdrop {
      &,
      &:first-child,
      &:last-child,
      &:only-child {
        border-top-left-radius: 0px;
        border-top-right-radius: 0px;
      }
    }
  }
}

.titlebar:not(headerbar) {
  window.csd > & {
    background-color: transparent;
    background-image: none;
    border-color: transparent;
    border-style: none;
    box-shadow: none;
    padding: 0px;
  }

  separator {
    background-color: $borders_color;
  }

  @extend %titlebar;
}

// Pathbars //

filechooser .path-bar.linked > button {
  @extend %linked_flippable;
  margin: 0px;
}

filechooser {
  #pathbarbox {
    background-color: $base_color;
    border-bottom: 1px solid $borders_color;
  }
}

.path-bar button {
  &.text-button, &.image-button, &, image {
    padding-left: 4px;
    padding-right: 4px;
  }

  &.text-button.image-button label, &.slider-button {
    padding-left: 0px;
    padding-right: 0px;
  }

  &.text-button.image-button, & {
    label:last-child {
      padding-right: 8px;
    }

    label:first-child {
      padding-left: 8px;
    }
  }
}

// Tree Views //

treeview.view {
  @at-root * {
    -GtkTreeView-expander-size: 16;
    -GtkTreeView-grid-line-pattern: '';
    -GtkTreeView-grid-line-width: 1;
    -GtkTreeView-horizontal-separator: 4;
    -GtkTreeView-tree-line-pattern: '';
    -GtkTreeView-tree-line-width: 1;
  }

  border-top-color: $bg_color;

  rubberband {
    @extend rubberband;
  }

  &:selected {
    &:focus, & {
      border-radius: 0px;
      @extend %selected_items;
    }
  }

  &:disabled {
    color: $insensitive_fg_color;
    &:selected {
      color: mix($selected_fg_color, $selected_bg_color, 40%);
    }
  }

  &.separator {
    color: $bg_color;
    min-height: 2px;
  }

  &:drop(active) {
    border-color: $focus_color;
    border-style: solid none;
    border-width: 1px;

    &.after {
      border-top-style: none;
    }

    &.before {
      border-bottom-style: none;
    }
  }

  &.expander {
    -gtk-icon-source: -gtk-icontheme("pan-end-symbolic");

    &:dir(rtl) {
      -gtk-icon-source: -gtk-icontheme("pan-end-symbolic-rtl");
    }

    color: mix($fg_color, $base_color, 50%);

    &:hover {
      color: $fg_color;
    }

    &:selected {
      color: mix($selected_fg_color, $selected_bg_color, 70%);
      &:hover {
        color: $selected_fg_color;
      }
    }

    &:checked {
      -gtk-icon-source: -gtk-icontheme("pan-down-symbolic");
    }
  }

  &.progressbar {
    @if $variant == light {
      color: $base_color;
    }

    background-color: $selected_bg_color;
    background-image: image($selected_bg_color);
    box-shadow: none;

    &:selected {
      &:focus, & {
        @if $variant == "light" {
          color: $selected_bg_color;
        }
        @else {
          box-shadow: inset 0 1px transparentize(white, 0.95);
        }

        background-image: image($base_color);

        &:backdrop {
          @if $variant == "light" {
            color: $selected_bg_color;
          }
          background-color: $base_color;
        }
      }
    }

    &:backdrop {
      background-image: none;
      box-shadow: none;
      color: $base_color;
    }
  }

  &.trough {
    background-color: transparentize($fg_color, 0.9);

    &:selected {
      &:focus, & {
        background-color: if($variant == "light", transparentize($selected_fg_color, 0.7), darken($selected_bg_color, 10%));
      }
    }
  }

  header {
    background-color: $header_bg;
    button {
      @extend %column_header_button;
      background-color: $bg_color;
      border-style: solid;
      border-width: 1px;
      box-shadow: none;
      color: $column_header_color;
      font-weight: bold;
      text-shadow: none;
      transition: 0s;

      &:hover {
        @extend %column_header_button;
        background-image: $shiny_hover;
        box-shadow: 0px 0px 4px 0px $box_shadow_color;
      }

      &:active {
        @extend %column_header_button;
        background-color: $active_column_color;
      }
    }
  }

  button.dnd, header.button.dnd {
    &:active, &:selected, &:hover, & {
      background-color: $dnd_column_color;
      background-image: none;
      border-radius: $button-radius;
      border-style: none;
      box-shadow: inset 0px 0px 0px 1px $box_shadow_color;
      color: $base_color;
      padding: 0px 8px;
      text-shadow: none;
      transition: 0s;
    }
  }
}

// Menus //

.menubar, menubar {
  -GtkWidget-window-dragging: false;
  @extend %menu_appearance;
}

.context-menu, .menu, menu {
  @extend %menu_appearance;
  background-color: $menu_bg_color;
  &:backdrop {
    background-color: $backdrop_menu_color;
  }
}

menuitem {
  @extend %menuitem;
}

// Popovers //

popover.background {
  background-color: $popover_bg_color;
  border-radius: $window-radius;
  padding: 2px;

  .csd &, & {
    border: 1px solid rgba(0, 0, 0, 0.3);
  }

  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);

  & modelbutton.flat:hover,
  &.menuitem.button.flat:hover {
    background-color: $selected_bg_color;
    border-radius: $button-radius;
    color: $selected_fg_color;
  }

  > list,
  > .view,
  > toolbar {
    border-style: none;
    background-color: transparent;
  }

  .csd &, & {
    &.touch-selection,
    &.magnifier {
      @extend %osd;
      border: 1px solid rgba(255, 255, 255, 0.1);

      button {
        @extend %osd_button;
      }
    }

    &.osd {
      @extend %osd;
    }
  }

  separator {
    margin: 4px;
  }

  list separator {
    margin: 0px;
  }

  checkbutton, radiobutton {
    @extend modelbutton, .flat;
  }
}

// Notebooks & Tabs //

notebook {
  padding: 0px;

  > header {
    background-color: $tabbar_color;
    border-color: $borders_color;
    border-width: 0px;
    padding: 0px;
    &.top tabs {
      margin: 0px 0px -1px 0px;
    }
    &.bottom tabs {
      margin: -1px 0px 0px 0px;
    }
    &.right tabs {
      margin: 0px 0px 0px -1px;
    }
    &.left tabs {
      margin: 0px -1px 0px 0px;
    }
    @each $po in top, right, bottom, left {
      @if $po == top {
        padding-top: 1px;
      }
      @else if $po == left {
        padding-left: 1px;
      }
      @else if $po == right {
        padding-right: 1px;
      }
      @else if $po == bottom {
        padding-bottom: 1px;
      }
      &.#{$po} {
        box-shadow: none;
        > tabs {
          > tab {
            transition-duration: 0s;
            &:hover {
              background-color: transparentize($base_color, 0.6);
              background-color: if($variant == "light", transparentize($base_color, 0.6), $base_color);
            }
            &:checked, &:checked:hover {
              background-color: $base_color;
              box-shadow: none;
            }
          }
        }
      }
      &.#{$po} > tabs > arrow {
        border-style: none;
        @if $po == top or $po == bottom {
          @extend %notebook_vert_arrows;
        }
        @if $po == left or $po == right {
          @extend %notebook_horz_arrows;
        }
      }
      &.#{$po} {
        @if $po == top or $po == bottom {
          padding-left: 0px;
          padding-right: 0px;
        }
        @if $po == left or $po == right {
          padding-bottom: 0px;
          padding-top: 0px;
        }
      }
    }

    tabs {
      margin: 0px;
    }

    @at-root %notebook_vert_arrows {
      margin-left: -4px;
      margin-right: -4px;
      padding-left: 4px;
      padding-right: 4px;

      &.down {
        -gtk-icon-source: -gtk-icontheme("pan-start-symbolic");
      }

      &.up {
        -gtk-icon-source: -gtk-icontheme("pan-end-symbolic");
      }
    }

    @at-root %notebook_horz_arrows {
      margin-bottom: -4px;
      margin-top: -4px;
      padding-bottom: 4px;
      padding-top: 4px;

      &.down {
        -gtk-icon-source: -gtk-icontheme("pan-up-symbolic");
      }

      &.up {
        -gtk-icon-source: -gtk-icontheme("pan-down-symbolic");
      }
    }

    > tabs > arrow {
      @extend %button_basic;
      @extend %button_basic, .flat;
      border-radius: 0px;
      min-height: 16px;
      min-width: 16px;

      &:hover:not(:active):not(:backdrop) {
        background-clip: padding-box;
        background-color: rgba(255, 255, 255, 0.3);
        background-image: none;
        border-color: transparent;
        box-shadow: none;
      }

      &:disabled {
        @include button(undecorated);
      }
    }

    tab {
      background-color: if($variant == "light", inherit, #243);
      border-style: solid;
      border-width: 1px;
      color: $insensitive_fg_color;
      font-weight: bold;
      min-height: 32px;
      min-width: 64px;
      outline-offset: 0px;
      outline-style: none;
      padding: 4px;

      &:hover {
        color: mix($insensitive_fg_color, $fg_color, 40%);

        &.reorderable-page {
          border-color: transparentize($borders_color, 1);
        }
      }

      &:checked {
        border-left-color: if($variant == "light", inherit, #FFF);
        border-right-color: if($variant == "light", inherit, #FFF);
        border-top-color: if($variant == "light", inherit, #FFF);
        color: $fg_color;
        font-weight: bold;

        &.reorderable-page {
          background-color: transparentize($bg_color, 0.5);
          border-color: transparentize($borders_color, 0.5);

          &:hover {
            background-color: transparentize($bg_color, 0.3);
          }
        }
      }

      button {
        border-color: if($variant == "light", inherit, #555);
        margin-left: if($variant == "light", inherit, 2px);
      }

      button.flat {
        color: transparentize($fg_color, 0.7);

        &:hover {
          color: currentColor;
        }

        margin-bottom: 4px;
        margin-top: 4px;
        min-height: 20px;
        min-width: 20px;
        padding: 0px;

        &:last-child {
          margin-left: 4px;
          margin-right: -4px;
        }

        &:first-child {
          margin-left: -4px;
          margin-right: 4px;
        }
      }
    }

    &.top,
    &.bottom {
      tabs {
        padding-left: 0px;
        padding-right: 0px;

        &:not(:only-child) {
          margin-left: 0px;
          margin-right: 0px;

          &:first-child {
            margin-left: 0px;
          }

          &:last-child {
            margin-right: 0px;
          }
        }

        tab {
          margin-left: 2px;
          margin-right: 2px;

          &.reorderable-page {
            border-style: solid;
            border-width: 1px;
          }
        }
      }
    }

    &.left,
    &.right {
      tabs {
        padding-bottom: 0px;
        padding-top: 0px;

        &:not(:only-child) {
          margin-top: 0px;
          margin-bottom: 0px;

          &:first-child {
            margin-top: 0px;
          }

          &:last-child {
            margin-bottom: 0px;
          }
        }

        tab {
          margin-bottom: 2px;
          margin-top: 2px;

          &.reorderable-page {
            border-style: solid;
            border-width: 1px;
          }
        }
      }
    }

    &.bottom tab, &.top tab {
      padding: 4px;
    }

  }

  > stack:not(:only-child) {
    background-color: $base_color;
  }
}

// Scrollbars //

scrollbar {
  @at-root * {
    -GtkScrollbar-has-backward-stepper: true;
    -GtkScrollbar-has-forward-stepper: true;
  }

  background-color: $base_color;
  border-width: 0px;
  opacity: 1;
  transition: 0s;

  slider {
    background-clip: padding-box;
    background-color: $scrollbar_slider_color;
    border-radius: 0px;
    border: 1px solid transparent;
    margin: -1px;
    transition: $scroll_duration;

    &:hover, &:hover:active {
      background-color: $scrollbar_slider_hover_color;
    }

    &:disabled {
      background-color: transparent;
    }
  }

  &.fine-tune {
    slider {
      min-height: $_scrollbar_size;
      min-width: $_scrollbar_size;
    }

    &.horizontal slider, &.vertical slider {
      border-width: 1px;
    }

  }

  button {
    border-radius: $button-radius;
    border-style: none;
    box-shadow: none;
    color: $scrollbar_slider_color;
    min-height: $_scrollbar_size;
    min-width: $_scrollbar_size;
    padding: 0px;
    transition-property: min-height, min-width, color;

    &:hover {
      box-shadow: none;
      color: $scrollbar_slider_hover_color;
    }

    &:active, &:checked {
      box-shadow: inset 0px 0px 4px 0px rgba(0, 0, 0, 0.3);
      color: $scrollbar_slider_active_color;
    }

    &:disabled {
      background-color: transparent;
      box-shadow: none;
      color: transparentize($scrollbar_slider_color, 0.8);
    }
  }

  &.vertical {
    button {
      @each $s, $as in ("", ""), (":disabled", "-insensitive") {
        &.up#{$s} {
          $_url: if($variant == "dark", "assets/scrollarrow-up#{$asset_suffix}", "assets/scrollarrow-up#{$as}");
          -gtk-icon-source: -gtk-scaled(url("#{$_url}.png"), url("#{$_url}@2.png"));
        }

        &.down#{$s} {
          $_url: if($variant == "dark", "assets/scrollarrow-down#{$asset_suffix}", "assets/scrollarrow-down#{$as}");
          -gtk-icon-source: -gtk-scaled(url("#{$_url}.png"), url("#{$_url}@2.png"));
        }
      }
    }
    slider {
      min-height: $_slider_min_length;
      min-width: $_scrollbar_size;
    }
  }

  &.horizontal {
    button {
      @each $s, $as in ("", ""), (":disabled", "-insensitive") {
        &.up#{$s} {
          $_url: if($variant == "dark", "assets/scrollarrow-left#{$asset_suffix}", "assets/scrollarrow-left#{$as}");
          -gtk-icon-source: -gtk-scaled(url("#{$_url}.png"), url("#{$_url}@2.png"));
        }

        &.down#{$s} {
          $_url: if($variant == "dark", "assets/scrollarrow-right#{$asset_suffix}", "assets/scrollarrow-right#{$as}");
          -gtk-icon-source: -gtk-scaled(url("#{$_url}.png"), url("#{$_url}@2.png"));
        }
      }
    }
    slider {
      min-height: $_scrollbar_size;
      min-width: $_slider_min_length;
    }
  }
}

treeview ~ scrollbar.vertical {
  border-top: 1px solid $borders_color;
  margin-top: -1px;
}

// Switch //

switch {
  background-clip: padding-box;
  background-color: $dark_fill;
  border-radius: $circular_radius;
  border: 1px inset darken($dark_fill, 20%);
  font-size: 0px;
  margin: 0px;
  padding: 0px;
  transition: $shortest_duration $deceleration_curve, opacity $longer_duration $deceleration_curve;

  &:checked {
    background-color: if($variant == "light", $selected_bg_color, $dark_fill);
    border-color: if($variant == "light", $focus_color, $borders_color);
  }

  &:disabled {
    opacity: 0.5;
  }

  slider {
    background-color: if($variant == "dark", lighten($bg_color, 9%), $base_color);
    border-radius: $circular_radius;
    box-shadow: 0 0 2px 1px transparent, $shadow_normal;
    border: 1px outset darken($dark_fill, 20%);
    color: $fg_color;
    margin: 2px;
    min-height: $_switch_min_length;
    min-width: $_switch_min_length;
    transition: all $shortest_duration $deceleration_curve, box-shadow $longer_duration $deceleration_curve;
  }

  &:hover slider {
    box-shadow: $shadow_hover;
    background-color: if($variant == "light", lighten($bg_color, 12%), lighten($base_color, 6%));
  }

  &:checked slider {
    background-color: if($variant == "light", lighten($bg_color, 12%), $selected_bg_color);
    border-radius: $circular_radius;
    color: $fg_color;
  }

  &:checked:hover slider, &:focus slider, &:focus:hover slider {
    box-shadow: $shadow_hover;
  }

  row:selected &, menuitem:hover & {
    &:checked {
      background-color: transparentize(lighten($selected_bg_color, 20%), 0.5);
    }

    &:checked slider {
      background-color: lighten(lighten($selected_bg_color, 20%), 20%);
    }

    &:focus slider, &:hover slider, &:focus:hover slider {
      box-shadow: $shadow_hover;
    }

  }

  image {
    color: transparentize($fg_color, 0.3);
    &:checked {
      color: $selected_fg_color;
    }
  }
}

// Check & Radio items //

@each $check_state, $check_icon, $check_color, $check_background in
  ("", "none", "transparent", "#{transparentize($selected_bg_color, 0.05)}"),
  (":hover", "none", "transparent", "#{transparentize($selected_bg_color, 0.05)}"),
  (":active", "none", "transparent", "#{transparentize($selected_bg_color, 0.05)}"),
  (":backdrop", "none", "transparent", "#{transparentize(desaturate($selected_bg_color, 100%), 0.05)}"),
  (":checked", "-gtk-icontheme('object-select-symbolic')", "#{$osd_fg_color}", "#{transparentize($selected_bg_color, 0.05)}"),
  (":checked:hover", "-gtk-icontheme('object-select-symbolic')", "#{$osd_fg_color}", "#{transparentize($selected_bg_color, 0.05)}"),
  (":checked:active", "-gtk-icontheme('object-select-symbolic')", "#{$osd_fg_color}", "#{transparentize($selected_bg_color, 0.05)}"),
  (":backdrop:checked", "-gtk-icontheme('object-select-symbolic')", "#{transparentize($osd_fg_color, 0.2)}", "#{transparentize(desaturate($selected_bg_color, 100%), 0.05)}") {
    .view.content-view.check#{$check_state}:not(list),
    .content-view .tile check#{$check_state}:not(list) {
      -gtk-icon-shadow: none;
      -gtk-icon-source: #{$check_icon};
      background-color: #{$check_background};
      background-image: none;
      border-radius: $button-radius;
      border-width: 0px;
      box-shadow: none;
      color: #{$check_color};
      margin: 4px;
      min-height: 32px;
      min-width: 32px;
      transition: $checkbox_duration;
  }
}

checkbutton.text-button, radiobutton.text-button {
  outline-offset: 0px;
  padding: 2px 0px;

  label:not(:only-child) {
    &:first-child {
      margin-left: 4px;
    }

    &:last-child {
      margin-right: 4px;
    }
  }
}

check, radio {
  -gtk-icon-source: none;
  border: 1px solid;
  margin: 0px 4px;
  min-height: 16px;
  min-width: 16px;
  transition: $checkbox_duration;
  &:indeterminate {
    -gtk-icon-source: image(-gtk-recolor(url("assets/dash-symbolic.svg")), -gtk-recolor(url("assets/dash-symbolic.symbolic.png")));
  }

  &:only-child {
    margin: 0px;
  }

  @include check(normal);

  &:active, &:active:backdrop, &:active:hover, &:focus, &:focus:backdrop, &:hover, &:hover:backdrop {
    @include check(hover);
  }
  &:checked:hover {
    @include check(hover);
  }
  &:checked, &:checked:backdrop {
    @include check(checked);
  }
  &:disabled {
    @include check(insensitive);
  }
  &:disabled:backdrop, &:disabled:checked:backdrop {
    @include check(insensitive);
    color: $insensitive_fg_color;
  }

  @if $variant == "light" {
    row:selected & {
      border-color: $focus_color;
    }
  }

  .osd & {
    @include button(osd);
    &:hover {
      @include button(osd);
    }
    &:active {
      @include button(osd-active);
    }
    &:disabled {
      @include button(osd-insensitive);
    }
  }

  menu menuitem & {

    &, &:disabled, &:checked {
      background-color: transparent;
      background-image: none;
      border-color: $borders_color;
      box-shadow: none;
      color: inherit;
    }

    &:checked:hover, &:hover {
      background-color: if($variant == "light", $osd_fg_color, darken($osd_fg_color, 30%));
      border-color: $focus_color;
      color: $fg_color;
      &:backdrop {
        color: transparentize($osd_fg_color, 0.2);
      }
    }
  }
}

check {
  border-radius: $button-radius;
  &:checked {
    -gtk-icon-source: image(-gtk-recolor(url("assets/check-symbolic.svg")), -gtk-recolor(url("assets/check-symbolic.symbolic.png")));
  }
}

radio, treeview.view radio:selected, treeview.view radio:selected:focus {
  border-radius: $circular_radius;
  &:checked {
    -gtk-icon-source: image(-gtk-recolor(url("assets/bullet-symbolic.svg")), -gtk-recolor(url("assets/bullet-symbolic.symbolic.png")));
  }
}

treeview.view check, treeview.view radio {
  &:selected {
    &:focus, & {
      background-color: $selected_bg_color;
      border-color: $focus_color;
      color: $selected_fg_color;
    }

    &:disabled {
      color: $insensitive_fg_color;
      &:backdrop {
        color: $backdrop_insensitive_color;
      }
    }
  }

  &:backdrop {
    &:selected, & {
      color: $selected_fg_color;
    }
  }
}

// Level, Progress, & Scale Bars //

levelbar {
  &.horizontal {
    block {
      min-height: $scroller_min_thickness;
    }

    &.discrete block {
      margin: 0px 1px;
      min-width: 32px;
    }
  }

  &.vertical {
    block {
      min-width: $scroller_min_thickness;
    }

    &.discrete block {
      margin: 1px 0px;
      min-height: 32px;
    }
  }

  trough {
    border-radius: $button-radius;
    border: 1px inset darken($inset_color, 20%);
    padding: 2px;
    @include entry(normal);
    border-color: $borders_color;
    box-shadow: none;
    &:backdrop {
      @include entry(backdrop);
    }
  }

  block {
    border: 1px outset darken($dark_fill, 20%);
    border-radius: 0px;

    &.low {
      background-color: $warning_color;
      border-color: if($variant == "light", darken($warning_color, 20%), $warning_color);

      &:backdrop {
        border-color: $warning_color;
      }
    }

    &.high,
    &:not(.empty) {
      background-color: $selected_bg_color;
      border-color: if($variant == "light", darken($selected_bg_color, 20%), $selected_bg_color);

      &:backdrop {
        border-color: $selected_bg_color;
      }
    }

    &.full {
      background-color: $success_color;
      border-color: if($variant == "light", darken($success_color, 20%), $success_color);

      &:backdrop {
        border-color: $success_color;
      }
    }

    &.empty {
      background-color: transparent;
      border-color: if($variant == "light", transparentize($fg_color, 0.8), transparentize($fg_color, 0.9));

      &:backdrop {
        border-color: transparentize($backdrop_fg_color, 0.85);
      }
    }
  }
}

progressbar {
  &.horizontal {
    trough, progress {
      min-height: $scroller_min_thickness;
    }
  }

  &.vertical {
    trough, progress {
      min-width: $scroller_min_thickness;
    }
  }

  trough {
    background-color: if($variant == "light", darken($bg_color, 12%), $dark_borders_color);
    border: 1px inset darken($inset_color, 20%);
  }

  &.horizontal progress {
    margin: 0px -1px;
  }

  &.vertical progress {
    margin: -1px 0px;
  }

  color: transparentize($fg_color, 0.6);
  font-size: smaller;

  trough {
    @extend %scale_trough;
  }

  progress {
    @extend %scale_highlight;
    border-radius: $scale_radius;

    &.left {
      border-bottom-left-radius: $scale_radius;
      border-top-left-radius: $scale_radius;
    }

    &.right {
      border-bottom-right-radius: $scale_radius;
      border-top-right-radius: $scale_radius;
    }

    &.top {
      border-top-left-radius: $scale_radius;
      border-top-right-radius: $scale_radius;
    }

    &.bottom {
      border-bottom-left-radius: $scale_radius;
      border-bottom-right-radius: $scale_radius;
    }
  }

  &.osd {
    background-color: transparent;
    min-height: 8px;
    min-width: 8px;

    trough {
      background-color: transparent;
      border-radius: 0px;
      border: 1px inset darken($inset_color, 20%);
    }

    progress {
      border-radius: 0px;
      border-style: none;
    }
  }

  trough.empty progress {
    all: unset;
  }
}

scale {
  min-height: $scroller_min_thickness;
  min-width: $scroller_min_thickness;
  padding: 8px;

  &.horizontal {
    min-height: $scroller_min_thickness;
    min-width: 64px;
    trough {
      min-height: $scroller_min_thickness;
    }
  }

  &.vertical {
    min-height: 64px;
    min-width: $scroller_min_thickness;
    trough {
      min-width: $scroller_min_thickness;
    }
  }

  fill, highlight {
    margin: -1px;
  }

  slider {
    min-height: $scroller_min_thickness;
    min-width: $scroller_min_thickness;
    margin: -8px;
  }

  &.fine-tune {
    &.horizontal {
      min-height: $scroller_min_thickness;
      padding-bottom: 8px;
      padding-top: 8px;
    }

    &.vertical {
      min-width: $scroller_min_thickness;
      padding-left: 8px;
      padding-right: 8px;
    }

    slider {
      margin: -8px;
    }

    fill,
    highlight,
    trough {
      -gtk-outline-radius: 8px;
      border-radius: 8px;
    }
  }

  trough {
    @extend %scale_trough;
    -gtk-outline-radius: 8px;
    outline-style: none;
    &:focus:not(:disabled) {
      box-shadow: 0px 0px 4px 2px $select_color;
    }
  }

  highlight {
    @extend %scale_highlight;
  }

  fill {
    @extend %scale_trough;

    &:disabled {
      background-color: transparent;
      border-color: transparent;
    }

    .osd & {
      background-color: mix($osd_fg_color, $osd_borders_color, 25%);

      &:disabled {
        background-color: transparent;
        border-color: transparent;
      }
    }
  }

  slider {
    transition: all $shortest_duration $deceleration_curve, box-shadow $shorter_duration $deceleration_curve;

    @include button(normal);

    border-radius: 100%;
    border: 1px outset darken($dark_fill, 20%);

    &:hover {
      @include button(hover);
      background-color: lighten($bg_color, 18%);
      box-shadow: $shadow_hover;
    }

    &:active, &:checked {
      border-color: $focus_color;
      box-shadow: $shadow_hover;
    }

    &:disabled {
      @include button(insensitive);
    }

    row:selected & {
      &, &:disabled {
        border-color: $focus_color;
      }
    }

    .osd & {
      @include button(osd);
      background-color: opacify($osd_bg_color, 1);
      border-color: darken($osd_borders_color, 3%);

      &:hover {
        @include button(osd-hover);
      }

      &:active {
        @include button(osd-active);
      }

      &:disabled {
        @include button(osd-insensitive);
      }
    }
  }

  value {
    color: gtkalpha(currentColor, 0.6);
  }

  marks {
    color: gtkalpha(currentColor, 0.6);

    @each $marks_class, $marks_pos, $marks_margin in (top, top, bottom), (bottom, bottom, top), (top, left, right), (bottom, right, left) {
      &.#{$marks_class} {
        margin-#{$marks_margin}: $_marks_distance;
        margin-#{$marks_pos}: -($_marks_distance + $_marks_length);
      }
    }
  }

  &.fine-tune marks {
    @each $marks_class, $marks_pos, $marks_margin in (top, top, bottom), (bottom, bottom, top), (top, left, right), (bottom, right, left) {
      &.#{$marks_class} {
        margin-#{$marks_margin}: $_marks_distance;
        margin-#{$marks_pos}: -($_marks_distance + $_marks_length - 3px);
      }
    }
  }

  @each $scale_orient, $marks_class, $marks_pos, $marks_margin in (horizontal, top, top, bottom), (horizontal, bottom, bottom, top), (vertical, top, left, right), (vertical, bottom, right, left) {
    &.#{$scale_orient} marks {
      &.#{$marks_class} {
        margin-#{$marks_margin}: $_marks_distance;
        margin-#{$marks_pos}: -($_marks_distance + $_marks_length);
      }
    }

    &.#{$scale_orient}.fine-tune marks {
      &.#{$marks_class} {
        margin-#{$marks_margin}: $_marks_distance;
        margin-#{$marks_pos}: -($_marks_distance + $_marks_length - 3px);
      }
    }
  }

  &.horizontal {
    indicator {
      min-height: $_marks_length;
      min-width: 1px;
    }

    &.fine-tune indicator {
      min-height: $_marks_length - 3px;
    }
  }

  &.vertical {
    indicator {
      min-height: 1px;
      min-width: $_marks_length;
    }

    &.fine-tune indicator {
      min-width: $_marks_length - 3px;
    }
  }

  @each $dir_class, $dir_infix in ("horizontal", "horz"), ("vertical", "vert") {
    @each $marks_infix, $marks_class in ("scale-has-marks-above", "marks-before:not(.marks-after)"), ("scale-has-marks-below", "marks-after:not(.marks-before)") {
      &.#{$dir_class}.#{$marks_class} {
        slider {
          border-radius: $button-radius;
          margin: -8px -4px;
          padding: 0px;

          $_scale_slider_bg_pos: bottom;

          @if $dir_class == "horizontal" {
            min-height: 22px;
            min-width: 8px;

            @if $marks_infix == "scale-has-marks-above" {
              $_scale_slider_bg_pos: top;
            }
          }
          @else {
            margin: -4px -8px;
            min-height: 8px;
            min-width: 22px;

            @if $marks_infix == "scale-has-marks-above" {
              $_scale_slider_bg_pos: left bottom;
            }
            @else {
              $_scale_slider_bg_pos: right bottom;
            }
          }
        }

        &.fine-tune slider {
          margin: -8px -4px;
          @if $dir_class == "horizontal" {}
          @else {
            margin: -4px -8px;
          }
        }
      }
    }
  }

  &.color {
    min-height: 0px;
    min-width: 0px;

    trough {
      background-image: image($borders_color);
      background-repeat: no-repeat;
    }

    &.horizontal {
      padding: 0px 0px 16px 0px;

      trough {
        background-position: 0px -4px;
        border-radius: 0px;
        padding-bottom: 4px;
      }

      slider {
        &:dir(ltr), &:dir(rtl) {
          &:hover, &:backdrop, &:disabled, &:backdrop:disabled, & {
            margin-bottom: -16px;
            margin-top: 8px;
          }
        }
      }
    }

    &.vertical {
      &:dir(ltr) {
        padding: 0px 0px 0px 16px;

        trough {
          background-position: 4px 0px;
          border-radius: 0px;
          padding-left: 4px;
        }

        slider {
          &:hover, &:backdrop, &:disabled, &:backdrop:disabled, & {
            margin-left: -16px;
            margin-right: 8px;
          }
        }
      }

      &:dir(rtl) {
        padding: 0px 16px 0px 0px;

        trough {
          background-position: -4px 0px;
          border-radius: 0px;
          padding-right: 4px;
        }

        slider {
          &:hover, &:backdrop, &:disabled, &:backdrop:disabled, & {
            margin-left: 8px;
            margin-right: -16px;
          }
        }
      }
    }

    &.fine-tune {
      &.horizontal {
        &:dir(ltr), &:dir(rtl) {
          padding: 0px 0px 8px 0px;

          trough {
            background-position: 0px -8px;
            padding-bottom: 8px;
          }

          slider {
            margin-bottom: -16px;
            margin-top: 8px;
          }
        }
      }

      &.vertical {
        &:dir(ltr) {
          padding: 0px 0px 0px 8px;

          trough {
            background-position: 8px 0px;
            padding-left: 8px;
          }

          slider {
            margin-left: -16px;
            margin-right: 8px;
          }
        }

        &:dir(rtl) {
          padding: 0px 8px 0px 0px;

          trough {
            background-position: -8px 0px;
            padding-right: 8px;
          }

          slider {
            margin-left: 8px;
            margin-right: -16px;
          }
        }
      }
    }
  }
}

// Frames //

frame > border, .frame {
  border-radius: 0px;
  border: 1px solid $borders_color;
  box-shadow: none;
  margin: 0px;
  padding: 0px;

  &.flat {
    border-style: none;
  }

  &:backdrop {
    border-color: $backdrop_borders_color;
  }
}

frame.flat > border {
  border-style: none;
}

actionbar > revealer > box {
  border-top: 1px solid $borders_color;
  padding: 8px;

  &:backdrop {
    border-color: $backdrop_borders_color;
  }
}

scrolledwindow {
  viewport.frame {
    border-style: none;
  }

  overshoot {
    &.top {
      @include overshoot(top);
    }

    &.bottom {
      @include overshoot(bottom);
    }

    &.left {
      @include overshoot(left);
    }

    &.right {
      @include overshoot(right);
    }
  }

  junction {
    background-color: $base_color;
    border-color: transparent;
    border-image: linear-gradient(to bottom, $borders_color 1px, transparent 1px) 0 0 0 1 / 0 1px stretch;

    &:dir(rtl) {
      border-image-slice: 0 1 0 0;
    }
  }
}

separator {
  background-color: $sep_color;
  min-height: 1px;
  min-width: 1px;
}

// Lists //

list {
  background-color: lighten($base_color, 12%);
  border-color: $borders_color;
  color: $text_color;

  row {
    padding: 2px;
  }
}

row {
  transition: 0s;

  &:hover {
    transition: 0s;
  }

  &.activatable {
    &.has-open-popup,
    &:hover {
      background-color: transparentize($fg_color, 0.6);
    }

    &:active {
      box-shadow: inset 0px 2px 2px rgba(0, 0, 0, 0.2);
    }

    &:selected {
      &:active {
        box-shadow: inset 0px 2px 4px rgba(0, 0, 0, 0.5);
      }

      &.has-open-popup,
      &:hover {
        background-color: mix($fg_color, $selected_bg_color, 10%);
      }
    }
  }

  &:selected {
    @extend %selected_items;
  }
}

// App Notifications //

.app-notification, .app-notification.frame {
  @extend %osd;
  background-clip: padding-box;
  background-color: $osd_bg_color;
  background-image: none;
  border-radius: 0px 0px $button-radius $button-radius;
  padding: 8px;

  button {
    @extend %osd_button;
  }

  border {
    border: none;
  }
}

// Dialogs //

messagedialog {
  // Message Dialog
  .titlebar {
    background-color: $header_bg;
    background-image: none;
    border-style: none;
    border-top-left-radius: $window-radius;
    border-top-right-radius: $window-radius;
    box-shadow: inset 0 1px transparentize($borders_edge, 0.4), inset 0 -1px transparentize($borders_edge, 0.7);
    min-height: 32px;
  }

  &.csd {
    &.background {
      border-bottom-left-radius: $window-radius;
      border-bottom-right-radius: $window-radius;
    }

    .dialog-action-area button {
      border-color: $borders_color;
      border-radius: 0px;
      border-style: none;
      border-top-style: solid;
      box-shadow: none;
      padding: 8px 16px;

      &:focus {
        background-color: $selected_bg_color;
        box-shadow: inset 0px 0px 0px 1px $selected_bg_color;
        color: $selected_fg_color;
      }

      &:first-child {
        -gtk-outline-bottom-left-radius: $button-radius;
        border-bottom-left-radius: $button-radius;
      }

      &:last-child {
        -gtk-outline-bottom-right-radius: $button-radius;
        border-bottom-right-radius: $button-radius;
      }
    }
  }
}

colorswatch {
  &, &:drop(active) {
    border-style: none;
  }

  &.top, &.bottom, &.right, &.left {
    border-radius: 0px;

    overlay {
      border-radius: 0px;
    }
  }

  &.dark {
    overlay {
      color: white;

      &:hover {
        border-color: if($variant == "light", rgba(0, 0, 0, 0.8), $borders_color);
      }

      &:backdrop {
        color: rgba(255, 255, 255, 0.5);
      }
    }
  }

  &.light {
    overlay {
      color: black;

      &:hover {
        border-color: if($variant == "light", rgba(0, 0, 0, 0.5), $borders_color);
      }

      &:backdrop {
        color: rgba(0, 0, 0, 0.5);
      }
    }
  }

  &:drop(active) {
    box-shadow: none;

    &.light overlay {
      border-color: $drop_target_color;
      box-shadow: inset 0px 0px 0px 2px if($variant == "light", darken($drop_target_color, 7%), $borders_color), inset 0px 0px 0px 1px $drop_target_color;
    }

    &.dark overlay {
      border-color: $drop_target_color;
      box-shadow: inset 0px 0px 0px 2px if($variant == "light", rgba(0, 0, 0, 0.3), $borders_color), inset 0px 0px 0px 1px $drop_target_color;
    }
  }

  overlay {
    border: 1px solid if($variant == "light", rgba(0, 0, 0, 0.3), $borders_color);
    box-shadow: $_colorswatch_overlay_shadow;

    &:hover {
      box-shadow: inset 0px 1px rgba(255, 255, 255, 0.3);
    }
  }

  &#add-color-button {
    border-radius: 0px;

    &:only-child {
      border-radius: 0px;
    }

    overlay {
      @include button(normal);

      &:hover {
        @include button(hover);
      }
    }
  }

  &:disabled {
    opacity: 0.5;

    overlay {
      border-color: rgba(0, 0, 0, 0.6);
      box-shadow: none;
    }
  }

  row:selected & {
    box-shadow: 0px 0px 0px 2px $selected_fg_color;
  }

  &#editor-color-sample {
    border-radius: 0px;

    overlay {
      border-radius: 0px;
    }
  }
}

colorchooser .popover.osd {
  border-radius: 0px;
  outline-style: none;
}

colorchooser scale.color.vertical trough {
  min-height: 512px;
  min-width: 32px;
}

colorchooser scale.color.horizontal trough {
  min-height: 32px;
  min-width: 512px;
}

filechooser {
  .dialog-action-box {
    border-top: 1px solid $borders_color;
  }

  #pathbarbox {
    border-bottom: 1px solid $bg_color;
  }
}

filechooserbutton:drop(active) {
  border-color: transparent;
  box-shadow: none;
}

fontchooser {
  min-width: 2048px;
}

fontchooser treeview {
  font-size: 10px;
  min-height: 1024px;
}

fontchooser entry:not(.search) {
  font-size: 10px;
  min-height: 128px;
}

fontchooser spinbutton:not(:disabled) > entry {
  min-height: 24px;
}

button.font {
  min-width: 128px;
}

printdialog {
  paper {
    background: white;
    border: 1px solid $borders_color;
    color: $fg_color;
    padding: 0px;
  }

  .dialog-action-box {
    margin: 8px;
  }
}

// Sidebar //

.sidebar {
  background-color: $sidebar_bg_color;
  border-style: none;

  &:not(separator) {
    @at-root %sidebar_left,
    &:dir(ltr),
    &.left,
    &.left:dir(rtl) {
      background-color: $sidebar_bg_color;
      border-left-style: none;
      border-right: 1px solid $borders_color;
    }

    @at-root %sidebar_right,
    &:dir(rtl),
    &.right {
      background-color: $sidebar_bg_color;
      border-left: 1px solid $borders_color;
      border-right-style: none;
    }
  }

  list {
    background-color: transparent;
  }

  paned & {
    &.left, &.right, &.left:dir(rtl), &:dir(rtl), &:dir(ltr), & {
      border-style: none;
    }
  }

  separator {
    background-color: transparent;
  }

  treeview, treeview:backdrop {
    background-color: $sidebar_bg_color;
  }
}

stacksidebar {
  &.sidebar {
    &:dir(ltr),
    &.left,
    &.left:dir(rtl) {
      list {
        @extend %sidebar_left;
      }
    }

    &:dir(rtl),
    &.right {
      list {
        @extend %sidebar_right;
      }
    }
  }

  row {
    padding: 8px 4px;

    > label {
      padding-left: 4px;
      padding-right: 4px;
    }

    &.needs-attention > label {
      @extend %needs_attention;

      background-size: 8px 8px, 0px 0px;
    }
  }
}

separator.sidebar {
  background-color: $borders_color;
  border-style: none;
  margin: 0px;

  &:backdrop {
    background-color: $backdrop_borders_color;
  }

  &.selection-mode,
  .selection-mode & {
    background-color: darken($selected_bg_color, 20%);
  }
}

// File Chooser //

row image.sidebar-icon {
  opacity: $_placesidebar_icons_opacity;
}

placessidebar {
  > viewport.frame {
    border-style: none;
    border-right: $borders_color;
  }

  separator {
    border-top: 1px solid $secondary_borders_color;
  }

  .sidebar-row {
    &:hover {
      background-color: $hover_color;
    }
  }

  row {
    min-height: 36px;
    padding: 0px;

    > revealer {
      padding: 0px 16px;
    }

    &:selected {
      color: $selected_fg_color;
    }

    &:disabled {
      color: $insensitive_fg_color;
    }

    image.sidebar-icon {
      opacity: $_placesidebar_icons_opacity;

      &:dir(ltr) {
        padding-right: 8px;
      }

      &:dir(rtl) {
        padding-left: 8px;
      }
    }

    label.sidebar-label {
      &:dir(ltr) {
        padding-right: 2px;
      }

      &:dir(rtl) {
        padding-left: 2px;
      }
    }

    @at-root button.sidebar-button {
      @extend %button_basic, .flat;
      @extend %button_selected, .flat;
      border-radius: 0px;
      margin-bottom: 4px;
      margin-top: 4px;
      min-height: 26px;
      min-width: 26px;
      padding: 0px;

      &:not(:hover):not(:active),
      &:backdrop {
        > image {
          opacity: $_placesidebar_icons_opacity;
        }
      }
    }

    &:selected:active {
      box-shadow: none;
    }

    &.sidebar-placeholder-row {
      background-clip: content-box;
      background-image: image($drop_target_color);
      min-height: 2px;
      padding: 0px 8px;
    }

    &.sidebar-new-bookmark-row {
      color: $selected_bg_color;
    }

    &:drop(active):not(:disabled) {
      box-shadow: inset 0px 1px $drop_target_color, inset 0px -1px $drop_target_color;
      color: $drop_target_color;

      &:selected {
        background-color: $drop_target_color;
        color: $selected_fg_color;
      }
    }
  }
}

placesview {
  .server-list-button > image {
    -gtk-icon-transform: rotate(0turn);
    transition: 0s;
  }

  .server-list-button:checked > image {
    -gtk-icon-transform: rotate(-0.5turn);
    transition: 0s;
  }

  row.activatable:hover {
    background-color: transparent;
  }

  > actionbar > revealer > box > label {
    padding-left: 8px;
    padding-right: 8px;
  }
}

// Paned //

paned {
  > separator {
    -gtk-icon-source: none;
    background-color: transparent;
    background-image: image($borders_color), image($borders_color);
    background-size: 0px 0px;
    border-style: none;
    min-height: 1px;
    min-width: 1px;

    &:selected {
      background-image: image($selected_bg_color);
    }

    &.wide {
      background-color: $bg_color;
      background-image: image($borders_color), image($borders_color);
      background-size: 1px 1px, 1px 1px;
      min-height: 4px;
      min-width: 4px;
    }
  }

  &.horizontal > separator {
    background-repeat: repeat-y;

    &:dir(ltr) {
      background-position: left;
      margin: 0px -8px 0px 0px;
      padding: 0px 8px 0px 0px;
    }

    &:dir(rtl) {
      background-position: right;
      margin: 0px 0px 0px -8px;
      padding: 0px 0px 0px 8px;
    }

    &.wide {
      background-position: left, right;
      background-repeat: repeat-y, repeat-y;
      margin: 0px;
      padding: 0px;
    }
  }

  &.vertical > separator {
    background-position: top;
    background-repeat: repeat-x;
    margin: 0px 0px -8px 0px;
    padding: 0px 0px 8px 0px;

    &.wide {
      background-position: bottom, top;
      background-repeat: repeat-x, repeat-x;
      margin: 0px;
      padding: 0px;
    }
  }
}

// GtkInfoBar //

infobar {
  border-style: none;

  &.info,
  &.question,
  &.warning,
  &.error {
    &:backdrop > revealer > box, & > revealer > box {
      label, & {
        color: $fg_color;
      }

      background-color: if($variant == "light", desaturate(lighten(invert($selected_bg_color), 45%), 30%), desaturate(darken(invert($selected_bg_color), 40%), 70%));
      border-bottom: 1px solid lighten($borders_color, 5%);
    }

    text-shadow: none;

    &:backdrop {
      text-shadow: none;
    }

    button {
      @include button(normal, $bg_color, $fg_color, none);

      &:hover {
        @include button(hover, $bg_color, $fg_color, none);
      }

      &:active,
      &:checked {
        @include button(active, $bg_color, $fg_color, none);
      }

      &:disabled {
        @include button(insensitive, $bg_color, $fg_color, none);
      }

      &:backdrop {
        @include button(backdrop, $bg_color, $fg_color, none);

        border-color: darken($bg_color, 25%);

        &:disabled {
          @include button(backdrop-insensitive, $bg_color, $fg_color, none);
          border-color: darken($bg_color, 25%);
        }
      }

      &:backdrop, & {
        label, & {
          color: $fg_color;
        }
      }
    }

    selection {
      background-color: darken($bg_color, 10%);
    }

    *:link {
      color: $link_color;
    }
  }
}

// Window Decorations //

decoration {
  border-radius: $window-radius $window-radius 0px 0px;
  border-width: 0px;
  box-shadow: 0px 1px 4px 1px rgba(0, 0, 0, 0.5), 0px 0px 0px 1px $_wm_border;
  margin: 8px;

  &:backdrop {
    box-shadow: 0px 1px 4px 1px transparent, 0px 1px 2px 1px rgba(0, 0, 0, 0.2), 0px 0px 0px 1px $_wm_border_backdrop;
  }

  .maximized &,
  .fullscreen &,
  .tiled &,
  .tiled-top &,
  .tiled-right &,
  .tiled-bottom &,
  .tiled-left & {
    border-radius: 0px;
  }

  .maximized &,
  .fullscreen &,
  .popup & {
    box-shadow: none;
  }

  .ssd {
    border-radius: $window-radius $window-radius 0px 0px;
    box-shadow: 0px 0px 0px 1px $_wm_border;

    &.maximized {
      border-radius: 0px;
    }

    background-color: $bg_color;
    border: none;
    box-shadow: inset 0px 1px transparentize($borders_edge, 0.4);
  }

  .csd.popup & {
    border-radius: 0px;
    box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.2), 0px 0px 0px 1px transparentize($_wm_border, 0.1);
  }

  tooltip.csd & {
    border-radius: $window-radius;
    box-shadow: none;
  }

  messagedialog.csd & {
    border-radius: $window-radius;
    box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.2), 0px 0px 0px 1px transparentize($_wm_border, 0.1);
  }

  .solid-csd & {
    background-color: $bg_color;
    border-radius: 0px;
    border: solid 1px $backdrop_borders_color;
    box-shadow: none;
    margin: 4px;
  }
}

.ssd .titlebar {
  background-color: $bg_color;
  border-width: 0px;
  box-shadow: inset 0px 1px transparentize($borders_edge, 0.4);
  padding: 2px 4px;

  &.default-decoration button.titlebutton {
    @extend %titlebutton;
    transition-duration: 0s;
  }
}

headerbar, .titlebar {
  &.default-decoration button.titlebutton {
    margin: 0px 2px;
    min-height: $titlebutton-height;
    min-width: 0px;
    padding: 0px 2px;
  }

  button.titlebutton {
    @extend %titlebutton;

    @include button(undecorated);

    @each $b in "close", "maximize", "minimize" {
      &.#{$b} {
        background-color: transparent;
        background-position: center;
        background-repeat: no-repeat;
        border-width: 0px;
        box-shadow: none;
        color: transparent;
        transition-duration: 0s;
        transition-property: background-color;

        @if $b == close {
          background-color: $close_button;

          &:hover, &:active {
            background-color: $close_button_hover;
          }

          &:backdrop {
            background-color: $close_button;

            &:hover, &:active {
              background-color: $close_button_hover;
            }
          }
        }
        @else if $b == maximize or minimize {
          &:hover, &:active {
            background-color: $selected_bg_color;
          }
        }
      }
    }

    @each $k in "close", "maximize", "minimize" {
      @each $l, $m in ("", ""), (":backdrop", "-backdrop"), (":hover", "-hover"), (":active", "-hover") {
        &.#{$k}#{$l} {
          @if $dark_header == "false" and $variant == "light" {
            background-image: -gtk-scaled(url("assets/titlebutton-#{$k}#{$m}.png"), url("assets/titlebutton-#{$k}#{$m}@2.png"));
          }
          @else {
            background-image: -gtk-scaled(url("assets/titlebutton-#{$k}-hover.png"), url("assets/titlebutton-#{$k}-hover@2.png"));
          }
        }
      }
    }

    @if variant == "dark" or $dark_header == "true" {
      &:not(:hover) {
        opacity: 0.8;
      }

      &:backdrop:not(:hover) {
        opacity: 0.5;
      }
    }
  }

  .maximized & {
    button.titlebutton {
      @each $l, $m in ("", ""), (":backdrop", "-backdrop"), (":hover", "-hover"), (":active", "-hover") {
        &.maximize#{$l} {
          @if $dark_header == "false" and $variant == "light" {
            background-image: -gtk-scaled(url("assets/titlebutton-unmaximize#{$m}.png"), url("assets/titlebutton-unmaximize#{$m}@2.png"));
          }
          @else {
            background-image: -gtk-scaled(url("assets/titlebutton-unmaximize-hover.png"), url("assets/titlebutton-unmaximize-hover@2.png"));
          }
        }
      }

      @if variant == "dark" or $dark_header == "true" {
        &:not(:hover) {
          opacity: 0.8;
        }

        &:backdrop:not(:hover) {
          opacity: 0.5;
        }
      }
    }
  }
}

// Touch Copy & Paste //

cursor-handle {
  background-color: $selected_bg_color;
  background-image: none;
  border-style: none;
  box-shadow: none;

  &.top {
    -gtk-icon-source: -gtk-icontheme("selection-start-symbolic");
  }

  &.bottom {
    -gtk-icon-source: -gtk-icontheme("selection-end-symbolic");
  }
}

:not(decoration):not(window):drop(active):focus,
:not(decoration):not(window):drop(active) {
  border-color: $drop_target_color;
  box-shadow: inset 0px 0px 0px 1px $drop_target_color;
}

stackswitcher button.text-button {
  min-width: 96px;
}

stackswitcher button.circular,
stackswitcher button.text-button.circular {
  min-height: 32px;
  min-width: 32px;
  padding: 0px;
}

// General Classes //

.content-view {
  background-color: darken($bg_color, 7%);

  &:hover {
    -gtk-icon-effect: highlight;
  }

  rubberband, .rubberband {
    @extend rubberband;
  }
}

.context-menu {
  font: initial;
}

.dim-label {
  opacity: 0.6;
  text-shadow: none;
}

.keycap {
  background-color: $base_color;
  border-color: if($variant == "light", mix($borders_color, $bg_color, 50%), $borders_color);
  border-radius: 4px;
  border: 1px solid;
  box-shadow: if($variant == "light", inset 0 -4px mix($base_color, $bg_color, 20%), inset 0 -4px mix($borders_color, $base_color, 60%));
  color: $fg_color;
  font-size: 10pt;
  margin-top: 2px;
  min-height: 24px;
  min-width: 20px;
  padding-bottom: 4px;
  padding-left: 4px;
  padding-right: 4px;
}

.floating-bar {
  background-color: $bg_color;
  font-size: smaller;

  &.bottom.left {
    border-right: 1px solid $borders_color;
    border-top: 1px solid $borders_color;
  }

  &.bottom.right {
    border-left: 1px solid $borders_color;
    border-top: 1px solid $borders_color;
  }
}

.icon-dropshadow {
  -gtk-icon-shadow: 0px 1px 16px rgba(0, 0, 0, 0.05), 0px -1px rgba(0, 0, 0, 0.05), 1px 0px rgba(0, 0, 0, 0.1), 0px 1px rgba(0, 0, 0, 0.3), -1px 0px rgba(0, 0, 0, 0.1);
}

.lowres-icon {
  -gtk-icon-shadow: 0px -1px rgba(0, 0, 0, 0.05), 1px 0px rgba(0, 0, 0, 0.1), 0px 1px rgba(0, 0, 0, 0.3), -1px 0px rgba(0, 0, 0, 0.1);
}

.monospace {
  font-family: Monospace;
}

.scale-popup {
  .osd & {
    @extend %osd;
  }

  .osd & button.flat {
    border-radius: $button-radius;
    border-style: none;
  }

  button {
    &:hover {
      @extend %undecorated_button;
      background-color: transparentize($fg_color, 0.9);
      border-radius: $button-radius;
    }
  }
}

.titlebar,
.background.tiled .titlebar,
.background.tiled-top .titlebar,
.background.tiled-right .titlebar,
.background.tiled-bottom .titlebar,
.background.tiled-left .titlebar,
.background.maximized .titlebar,
.background.solid-csd .titlebar,
.background .titlebar {
  &:backdrop, & {
    border-top-left-radius: $window-radius;
    border-top-right-radius: $window-radius;
  }
}


// Emoji //

popover.emoji-picker {
  padding-left: 0px;
  padding-right: 0px;
}

button.emoji-section {
  background: none;
  border-color: transparent;
  border-radius: $button-radius;
  border-style: none none solid;
  border-width: 2px;
  box-shadow: none;
  margin: 2px 4px 2px 4px;
  min-height: 28px;
  min-width: 32px;
  outline-offset: -4px;
  padding: 4px 0px 0px;
  text-shadow: none;

  &:backdrop:not(:checked) {
    border-color: transparent;
  }

  &:hover {
    border-color: $borders_color;
  }

  &:checked {
    border-color: $selected_bg_color;
  }

  label {
    opacity: 0.6;
    padding: 0px;
  }

  &:hover label {
    opacity: 0.8;
  }

  &:checked label {
    opacity: 1;
  }
}

.emoji {
  border-radius: $button-radius;
  font-size: x-large;
  padding: 4px;

  :hover {
    background: $selected_bg_color;
  }
}

// Miscellaneous //

buttonbox.horizontal.linked button {
  margin: 8px;
}

buttonbox.vertical.linked button {
  margin: 2px;
}
